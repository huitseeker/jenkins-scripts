#!/bin/bash -x
# When building with the intent of ditributing artifacts to
# artifactory, we expect $typesafeArtifactoryPassword to be set
# by jenkins as an environment variable.

publish=$1
artifactsDir=$2

scriptsDir="$( cd "$( dirname "$0" )/.." && pwd )"

# the next 2 lines assume `pwd` == the scala checkout site
commithash="$(git rev-parse HEAD | cut -c 1-7)"
antArgs="-Darchives.skipxz=true -Dbuild.release=true -Dmaven.version.suffix=\"-$commithash-SNAPSHOT\"" $scriptsDir/build
buildState=$?
$scriptsDir/archive-checkin
if [[ $publish == "publish" ]] ; then
    $scriptsDir/publish-checkin $artifactsDir
fi
publishState=$?
if [[ $publish == "publishMaven" ]]; then
    # this a ssumes an environment variable with a
    # typesafe.artifactory.com password is set up
    $scriptsDir/publish-artifactory $typesafeArtifactoryPassword
fi
publishStateMaven=$?

# i'm not a bash programmer.
if (( !($buildState || $publishState || $publishStateMaven) )) ; then
  exit 0
else
  exit 1
fi
